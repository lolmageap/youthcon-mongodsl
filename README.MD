# ìœ ìŠ¤ì½˜'24 ë°œí‘œì ì˜¤ë¦¬ì—”í…Œì´ì…˜

## ì‹¤ìŠµ ì§„í–‰ í™˜ê²½

- IntelliJ IDEA
- Java 21, Kotlin 1.9.24
- SpringBoot 3.3.1
- Gradle 8.4
- mongodb 7

## ì‹¤ìŠµì„ í•˜ê³  ì–»ëŠ” ê²ƒ

1. Kotlinì— ëŒ€í•œ ì´í•´ë„
2. MongoDBì— ëŒ€í•œ ì´í•´ë„
3. ì½”ë“œë¥¼ ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ëŠ” ë°©ë²•

## ë°œí‘œ ëŒ€ìƒ

1. Kotlinì— ê´€ì‹¬ì´ ìˆëŠ” ê°œë°œì
2. MongoDBì— ê´€ì‹¬ì´ ìˆëŠ” ê°œë°œì
3. ê°œì„ í•˜ëŠ” ê²ƒì„ ì¢‹ì•„í•˜ëŠ” ê°œë°œì
4. ë‚˜ë§Œì˜ DSLì„ ë§Œë“¤ì–´ë³´ê³  ì‹¶ì€ ê°œë°œì

## ì‹œë‚˜ë¦¬ì˜¤

1. ë°ì´í„°ê°€ ë“¤ì–´ ìˆëŠ” MongoDBì— ì—°ê²°í•©ë‹ˆë‹¤.
2. Kotlinì—ì„œ ì œê³µí•˜ëŠ” íƒ‘ë ˆë²¨ í•¨ìˆ˜, í™•ì¥ í•¨ìˆ˜, ì¤‘ìœ„ í•¨ìˆ˜ì— ëŒ€í•´ì„œ í•™ìŠµí•©ë‹ˆë‹¤.
3. Spring, Kotlinìœ¼ë¡œ MongoDB ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤.
4. ê¸°ì¡´ì— Criteriaë¡œ ì‘ì„±ëœ ë³µì¡í•œ ì½”ë“œë¥¼ DSLë¡œ ë¦¬íŒ©í† ë§í•©ë‹ˆë‹¤.

## ì„¤ì • ë°©ë²•

ë°ì´í„°ê°€ ë“¤ì–´ ìˆëŠ” MongoDB URIë¥¼ yml íŒŒì¼ì—ì„œ ì„¤ì •í•©ë‹ˆë‹¤.

```yaml
spring:
  application:
    name: youthcon-mongodsl
  data:
    mongodb:
      uri: mongodb://MONGO_ATLAS_HOST:27017/youthcon
```

## â­ï¸ MongoDB

RDBMSëŠ” Table ì´ë¼ëŠ” êµ¬ì¡°ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ì§€ë§Œ MongoDBëŠ” Collection ì´ë¼ëŠ” êµ¬ì¡°ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.  
Collectionì€ ì•„ë˜ì²˜ëŸ¼ Binary JSON í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.  
RDBMSì™€ ë‹¤ë¥´ê²Œ ë³µì¡í•œ ê´€ê³„ê°€ ì—†ëŠ” ë°ì´í„°ë¥¼ ì €ì¥í•  ë•Œ ì‚¬ìš©í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.  
ì‹¤ìŠµì—ì„œ ì§„í–‰í•  MongoDB Collection ì˜ˆì‹œì…ë‹ˆë‹¤.

```json
{
  "_id": "66ba029d667d035a53c2eb57",
  "name": "ì •ì² í¬",
  "age": 25,
  "status": "ACTIVE",
  "nickname": "ìœ ìŠ¤ì½˜",
  "weight": 65.0,
  "height": 170.0,
  "money": 1000,
  "books": [
    {
      "title": "Kotlin DSL",
      "price": 10000,
      "isbn": "1234567890",
      "description": "Kotlin DSLì— ëŒ€í•œ ì„¤ëª…"
    },
    {
      "title": "SpringBoot",
      "price": 20000,
      "isbn": "0987654321"
    }
  ]
}
```

## ğŸ”¥ ì‹¤ìŠµ

### 1ë²ˆ ì‹œë‚˜ë¦¬ì˜¤ - MongoDB ì´í•´

MongoDBì— êµ¬ì¡°ë¥¼ íŒŒì•…í•˜ê³  ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ë²•ì„ í•™ìŠµí•©ë‹ˆë‹¤.  
ê·¸ë¦¬ê³  ë¬¸ìì—´ì„ ë„˜ê¸°ëŠ” ë¹„íš¨ìœ¨ì ì¸ ì½”ë“œë¥¼ Criteriaë¡œ ì–´ë–»ê²Œ ì‘ì„±í•˜ëŠ”ì§€ íŒŒì•…í•©ë‹ˆë‹¤.  

```kotlin
    val json = """
        {
            "name": "youthcon",
            "age": 30
        }
    """.trimIndent()

    val jsonObject = JSONObject(json).toString()
    val query = BasicQuery(Document.parse(jsonObject))
```

```kotlin
    val criteria = Criteria().andOperator(
        Criteria.where("name").`is`("youthcon").and("age").`is`(30)
    )
    val query = Query.query(criteria)
```

### 2ë²ˆ ì‹œë‚˜ë¦¬ì˜¤ - Criteria ë¦¬íŒ©í† ë§

Criteriaë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ DSLë¡œ ë¦¬íŒ©í† ë§í•©ë‹ˆë‹¤.  
ì´ë•Œ Kotlinì´ ì§€ì›í•˜ëŠ” íƒ‘ë ˆë²¨ í•¨ìˆ˜, í™•ì¥ í•¨ìˆ˜, ì¤‘ìœ„ í•¨ìˆ˜ë¥¼ í™œìš©í•©ë‹ˆë‹¤.  

> ë‹‰ë„¤ì„ì— hyê°€ ë“¤ì–´ê°€ê³  ë‚˜ì´ê°€ 30ì„¸ ì´ìƒì¸ ì‘ê°€ë¥¼ ë‚˜ì´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•œë‹¤.

- AS IS
```kotlin
    val criteria = Criteria().andOperator(
        Criteria.where("nickname").regex("hy", "i"),
        Criteria.where("age").gte(20).lte(29),
    )

    val query = Query(criteria).with(Sort.by(Sort.Order(DESC, "age")))
    val authors = mongoTemplate.find(query, Author::class.java)
```

- TO BE
```kotlin
    val query = where {
        Author::nickname containsIgnoreCase "hy"
        Author::age between 20..29
    } order {
        Author::age by DESC
    }

    val authors = mongoTemplate.find(query, Author::class)
```

### 3ë²ˆ ì‹œë‚˜ë¦¬ì˜¤ - Criteria ì§‘ê³„ ë¦¬íŒ©í† ë§

Criteriaë¡œ ì‘ì„±ëœ ì§‘ê³„ ì½”ë“œë¥¼ DSLë¡œ ë¦¬íŒ©í† ë§í•©ë‹ˆë‹¤.  
MongoDBì˜ ì§‘ê³„ ë°©ì‹ì„ ì˜ ëª¨ë¥´ëŠ” ì‚¬ëŒë„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.    

> ë‚˜ì´ê°€ 20ëŒ€ì´ê³  ì±…ì„ 3ê¶Œ ë‚¸ ì‘ê°€ë¥¼ ìƒíƒœë³„ë¡œ ê·¸ë£¨í•‘í•œ ë’¤ ê°€ì§„ ëˆì˜ í•©ì„ êµ¬í•œë‹¤.

- AS IS
```kotlin
    val criteria = Criteria().andOperator(
        Criteria.where("nickname").regex("hy", "i"),
        Criteria.where("age").gte(20).lte(29),
    )

    val matchOperation = MatchOperation(criteria)
    val groupOperation = Aggregation.group("status").sum("money").`as`(TOTAL_MONEY)
    val aggregation = Aggregation.newAggregation(matchOperation, groupOperation)

    val aggregationResults = mongoTemplate.aggregate(aggregation, Author::class.java, Map::class.java)
```

- TO BE
```kotlin
    val aggregation = where {
        Author::nickname containsIgnoreCase "hy"
        Author::age between 20..29
    } groupBy {
        Author::status
    } sum {
        Author::money alias TOTAL_MONEY
    }

    val aggregationResults = mongoTemplate.aggregate(aggregation, Author::class.java, Map::class.java)
```

ì™„ì„±ë³¸ ì½”ë“œëŠ” complete branchì— ìˆìŠµë‹ˆë‹¤!
